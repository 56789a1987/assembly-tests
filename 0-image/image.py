from PIL import Image

vgaColors = [
	(0x00, 0x00, 0x00), # 00
	(0x00, 0x00, 0xAA), # 01
	(0x00, 0xAA, 0x00), # 02
	(0x00, 0xAA, 0xAA), # 03
	(0xAA, 0x00, 0x00), # 04
	(0xAA, 0x00, 0xAA), # 05
	(0xAA, 0x55, 0x00), # 06
	(0xAA, 0xAA, 0xAA), # 07
	(0x55, 0x55, 0x55), # 08
	(0x55, 0x55, 0xFF), # 09
	(0x55, 0xFF, 0x55), # 0A
	(0x55, 0xFF, 0xFF), # 0B
	(0xFF, 0x55, 0x55), # 0C
	(0xFF, 0x55, 0xFF), # 0D
	(0xFF, 0xFF, 0x55), # 0E
	(0xFF, 0xFF, 0xFF), # 0F
	(0x00, 0x00, 0x00), # 10
	(0x10, 0x10, 0x10), # 11
	(0x20, 0x20, 0x20), # 12
	(0x35, 0x35, 0x35), # 13
	(0x45, 0x45, 0x45), # 14
	(0x55, 0x55, 0x55), # 15
	(0x65, 0x65, 0x65), # 16
	(0x75, 0x75, 0x75), # 17
	(0x8A, 0x8A, 0x8A), # 18
	(0x9A, 0x9A, 0x9A), # 19
	(0xAA, 0xAA, 0xAA), # 1A
	(0xBA, 0xBA, 0xBA), # 1B
	(0xCA, 0xCA, 0xCA), # 1C
	(0xDF, 0xDF, 0xDF), # 1D
	(0xEF, 0xEF, 0xEF), # 1E
	(0xFF, 0xFF, 0xFF), # 1F
	(0x00, 0x00, 0xFF), # 20
	(0x41, 0x00, 0xFF), # 21
	(0x82, 0x00, 0xFF), # 22
	(0xBE, 0x00, 0xFF), # 23
	(0xFF, 0x00, 0xFF), # 24
	(0xFF, 0x00, 0xBE), # 25
	(0xFF, 0x00, 0x82), # 26
	(0xFF, 0x00, 0x41), # 27
	(0xFF, 0x00, 0x00), # 28
	(0xFF, 0x41, 0x00), # 29
	(0xFF, 0x82, 0x00), # 2A
	(0xFF, 0xBE, 0x00), # 2B
	(0xFF, 0xFF, 0x00), # 2C
	(0xBE, 0xFF, 0x00), # 2D
	(0x82, 0xFF, 0x00), # 2E
	(0x41, 0xFF, 0x00), # 2F
	(0x00, 0xFF, 0x00), # 30
	(0x00, 0xFF, 0x41), # 31
	(0x00, 0xFF, 0x82), # 32
	(0x00, 0xFF, 0xBE), # 33
	(0x00, 0xFF, 0xFF), # 34
	(0x00, 0xBE, 0xFF), # 35
	(0x00, 0x82, 0xFF), # 36
	(0x00, 0x41, 0xFF), # 37
	(0x82, 0x82, 0xFF), # 38
	(0x9E, 0x82, 0xFF), # 39
	(0xBE, 0x82, 0xFF), # 3A
	(0xDF, 0x82, 0xFF), # 3B
	(0xFF, 0x82, 0xFF), # 3C
	(0xFF, 0x82, 0xDF), # 3D
	(0xFF, 0x82, 0xBE), # 3E
	(0xFF, 0x82, 0x9E), # 3F
	(0xFF, 0x82, 0x82), # 40
	(0xFF, 0x9E, 0x82), # 41
	(0xFF, 0xBE, 0x82), # 42
	(0xFF, 0xDF, 0x82), # 43
	(0xFF, 0xFF, 0x82), # 44
	(0xDF, 0xFF, 0x82), # 45
	(0xBE, 0xFF, 0x82), # 46
	(0x9E, 0xFF, 0x82), # 47
	(0x82, 0xFF, 0x82), # 48
	(0x82, 0xFF, 0x9E), # 49
	(0x82, 0xFF, 0xBE), # 4A
	(0x82, 0xFF, 0xDF), # 4B
	(0x82, 0xFF, 0xFF), # 4C
	(0x82, 0xDF, 0xFF), # 4D
	(0x82, 0xBE, 0xFF), # 4E
	(0x82, 0x9E, 0xFF), # 4F
	(0xBA, 0xBA, 0xFF), # 50
	(0xCA, 0xBA, 0xFF), # 51
	(0xDF, 0xBA, 0xFF), # 52
	(0xEF, 0xBA, 0xFF), # 53
	(0xFF, 0xBA, 0xFF), # 54
	(0xFF, 0xBA, 0xEF), # 55
	(0xFF, 0xBA, 0xDF), # 56
	(0xFF, 0xBA, 0xCA), # 57
	(0xFF, 0xBA, 0xBA), # 58
	(0xFF, 0xCA, 0xBA), # 59
	(0xFF, 0xDF, 0xBA), # 5A
	(0xFF, 0xEF, 0xBA), # 5B
	(0xFF, 0xFF, 0xBA), # 5C
	(0xEF, 0xFF, 0xBA), # 5D
	(0xDF, 0xFF, 0xBA), # 5E
	(0xCA, 0xFF, 0xBA), # 5F
	(0xBA, 0xFF, 0xBA), # 60
	(0xBA, 0xFF, 0xCA), # 61
	(0xBA, 0xFF, 0xDF), # 62
	(0xBA, 0xFF, 0xEF), # 63
	(0xBA, 0xFF, 0xFF), # 64
	(0xBA, 0xEF, 0xFF), # 65
	(0xBA, 0xDF, 0xFF), # 66
	(0xBA, 0xCA, 0xFF), # 67
	(0x00, 0x00, 0x71), # 68
	(0x1C, 0x00, 0x71), # 69
	(0x39, 0x00, 0x71), # 6A
	(0x55, 0x00, 0x71), # 6B
	(0x71, 0x00, 0x71), # 6C
	(0x71, 0x00, 0x55), # 6D
	(0x71, 0x00, 0x39), # 6E
	(0x71, 0x00, 0x1C), # 6F
	(0x71, 0x00, 0x00), # 70
	(0x71, 0x1C, 0x00), # 71
	(0x71, 0x39, 0x00), # 72
	(0x71, 0x55, 0x00), # 73
	(0x71, 0x71, 0x00), # 74
	(0x55, 0x71, 0x00), # 75
	(0x39, 0x71, 0x00), # 76
	(0x1C, 0x71, 0x00), # 77
	(0x00, 0x71, 0x00), # 78
	(0x00, 0x71, 0x1C), # 79
	(0x00, 0x71, 0x39), # 7A
	(0x00, 0x71, 0x55), # 7B
	(0x00, 0x71, 0x71), # 7C
	(0x00, 0x55, 0x71), # 7D
	(0x00, 0x39, 0x71), # 7E
	(0x00, 0x1C, 0x71), # 7F
	(0x39, 0x39, 0x71), # 80
	(0x45, 0x39, 0x71), # 81
	(0x55, 0x39, 0x71), # 82
	(0x61, 0x39, 0x71), # 83
	(0x71, 0x39, 0x71), # 84
	(0x71, 0x39, 0x61), # 85
	(0x71, 0x39, 0x55), # 86
	(0x71, 0x39, 0x45), # 87
	(0x71, 0x39, 0x39), # 88
	(0x71, 0x45, 0x39), # 89
	(0x71, 0x55, 0x39), # 8A
	(0x71, 0x61, 0x39), # 8B
	(0x71, 0x71, 0x39), # 8C
	(0x61, 0x71, 0x39), # 8D
	(0x55, 0x71, 0x39), # 8E
	(0x45, 0x71, 0x39), # 8F
	(0x39, 0x71, 0x39), # 90
	(0x39, 0x71, 0x45), # 91
	(0x39, 0x71, 0x55), # 92
	(0x39, 0x71, 0x61), # 93
	(0x39, 0x71, 0x71), # 94
	(0x39, 0x61, 0x71), # 95
	(0x39, 0x55, 0x71), # 96
	(0x39, 0x45, 0x71), # 97
	(0x51, 0x51, 0x71), # 98
	(0x59, 0x51, 0x71), # 99
	(0x61, 0x51, 0x71), # 9A
	(0x69, 0x51, 0x71), # 9B
	(0x71, 0x51, 0x71), # 9C
	(0x71, 0x51, 0x69), # 9D
	(0x71, 0x51, 0x61), # 9E
	(0x71, 0x51, 0x59), # 9F
	(0x71, 0x51, 0x51), # A0
	(0x71, 0x59, 0x51), # A1
	(0x71, 0x61, 0x51), # A2
	(0x71, 0x69, 0x51), # A3
	(0x71, 0x71, 0x51), # A4
	(0x69, 0x71, 0x51), # A5
	(0x61, 0x71, 0x51), # A6
	(0x59, 0x71, 0x51), # A7
	(0x51, 0x71, 0x51), # A8
	(0x51, 0x71, 0x59), # A9
	(0x51, 0x71, 0x61), # AA
	(0x51, 0x71, 0x69), # AB
	(0x51, 0x71, 0x71), # AC
	(0x51, 0x69, 0x71), # AD
	(0x51, 0x61, 0x71), # AE
	(0x51, 0x59, 0x71), # AF
	(0x00, 0x00, 0x41), # B0
	(0x10, 0x00, 0x41), # B1
	(0x20, 0x00, 0x41), # B2
	(0x31, 0x00, 0x41), # B3
	(0x41, 0x00, 0x41), # B4
	(0x41, 0x00, 0x31), # B5
	(0x41, 0x00, 0x20), # B6
	(0x41, 0x00, 0x10), # B7
	(0x41, 0x00, 0x00), # B8
	(0x41, 0x10, 0x00), # B9
	(0x41, 0x20, 0x00), # BA
	(0x41, 0x31, 0x00), # BB
	(0x41, 0x41, 0x00), # BC
	(0x31, 0x41, 0x00), # BD
	(0x20, 0x41, 0x00), # BE
	(0x10, 0x41, 0x00), # BF
	(0x00, 0x41, 0x00), # C0
	(0x00, 0x41, 0x10), # C1
	(0x00, 0x41, 0x20), # C2
	(0x00, 0x41, 0x31), # C3
	(0x00, 0x41, 0x41), # C4
	(0x00, 0x31, 0x41), # C5
	(0x00, 0x20, 0x41), # C6
	(0x00, 0x10, 0x41), # C7
	(0x20, 0x20, 0x41), # C8
	(0x28, 0x20, 0x41), # C9
	(0x31, 0x20, 0x41), # CA
	(0x39, 0x20, 0x41), # CB
	(0x41, 0x20, 0x41), # CC
	(0x41, 0x20, 0x39), # CD
	(0x41, 0x20, 0x31), # CE
	(0x41, 0x20, 0x28), # CF
	(0x41, 0x20, 0x20), # D0
	(0x41, 0x28, 0x20), # D1
	(0x41, 0x31, 0x20), # D2
	(0x41, 0x39, 0x20), # D3
	(0x41, 0x41, 0x20), # D4
	(0x39, 0x41, 0x20), # D5
	(0x31, 0x41, 0x20), # D6
	(0x28, 0x41, 0x20), # D7
	(0x20, 0x41, 0x20), # D8
	(0x20, 0x41, 0x28), # D9
	(0x20, 0x41, 0x31), # DA
	(0x20, 0x41, 0x39), # DB
	(0x20, 0x41, 0x41), # DC
	(0x20, 0x39, 0x41), # DD
	(0x20, 0x31, 0x41), # DE
	(0x20, 0x28, 0x41), # DF
	(0x2D, 0x2D, 0x41), # E0
	(0x31, 0x2D, 0x41), # E1
	(0x35, 0x2D, 0x41), # E2
	(0x3D, 0x2D, 0x41), # E3
	(0x41, 0x2D, 0x41), # E4
	(0x41, 0x2D, 0x3D), # E5
	(0x41, 0x2D, 0x35), # E6
	(0x41, 0x2D, 0x31), # E7
	(0x41, 0x2D, 0x2D), # E8
	(0x41, 0x31, 0x2D), # E9
	(0x41, 0x35, 0x2D), # EA
	(0x41, 0x3D, 0x2D), # EB
	(0x41, 0x41, 0x2D), # EC
	(0x3D, 0x41, 0x2D), # ED
	(0x35, 0x41, 0x2D), # EE
	(0x31, 0x41, 0x2D), # EF
	(0x2D, 0x41, 0x2D), # F0
	(0x2D, 0x41, 0x31), # F1
	(0x2D, 0x41, 0x35), # F2
	(0x2D, 0x41, 0x3D), # F3
	(0x2D, 0x41, 0x41), # F4
	(0x2D, 0x3D, 0x41), # F5
	(0x2D, 0x35, 0x41), # F6
	(0x2D, 0x31, 0x41), # F7
	(0x00, 0x00, 0x00), # F8
	(0x00, 0x00, 0x00), # F9
	(0x00, 0x00, 0x00), # FA
	(0x00, 0x00, 0x00), # FB
	(0x00, 0x00, 0x00), # FC
	(0x00, 0x00, 0x00), # FD
	(0x00, 0x00, 0x00), # FE
	(0x00, 0x00, 0x00), # FF
]

def colorDistance(a, b):
	return (a[0] - b[0]) ** 2 + (a[1] - b[1]) ** 2 + (a[2] - b[2]) ** 2

def nearestColor(color):
	index = 0
	for i in range(len(vgaColors)):
		if colorDistance(color, vgaColors[i]) < colorDistance(color, vgaColors[index]):
			index = i
	return index

buf = []
img = Image.open("image.png").convert("RGB")
w, h = img.size

if w != 320 or h != 200:
	raise Exception("Unexpected image size, input {}x{}, expected 320x200".format(w, h))

for y in range(h):
	for x in range(w):
		index = nearestColor(img.getpixel((x, y)))
		buf.append(index)
	print("x={} y={} index={}".format(x, y, index))

out = open("image.bin", "wb")
out.write(bytes(buf))
out.close()
